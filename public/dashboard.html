<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Dashboard - Jayglo CellMoni Agent</title>
<link rel="stylesheet" href="css/style.css" />
<style>
  /* ===== Scoped styles so we don't affect other pages ===== */
  .dash-actions {
    display: flex;
    gap: 14px;
    flex-wrap: wrap;
    justify-content: center;
    margin-top: 18px;
  }
  .dash-actions .circle-btn {
    width: 78px;
    height: 78px;
    border-radius: 50%;
    border: none;
    background-color: #ff4d4d; /* red to match your theme */
    color: #fff;
    font-size: 12px;
    font-weight: 700;
    line-height: 1.1;
    padding: 8px;
    cursor: pointer;
    position: relative;
    transition: background-color 0.25s ease, transform 0.06s ease;
    box-shadow: 0 2px 8px rgba(0,0,0,0.15);
  }
  .dash-actions .circle-btn:active { transform: scale(0.98); }
  .dash-actions .circle-btn.loading {
    background-color: #b30000; /* dark red while loading */
    pointer-events: none;
  }
  .dash-actions .circle-btn .spinner {
    border: 3px solid rgba(255,255,255,0.35);
    border-top: 3px solid #fff;
    border-radius: 50%;
    width: 20px; height: 20px;
    animation: dashSpin 1s linear infinite;
    position: absolute;
    top: calc(50% - 10px);
    left: calc(50% - 10px);
  }
  @keyframes dashSpin { from { transform: rotate(0); } to { transform: rotate(360deg); } }

  /* keep your existing .form-container spacing nice under the buttons */
  .form-container .section-spacer { height: 8px; }
</style>
</head>
<body>
  <!-- Header -->
  <div class="header" style="display:flex;justify-content:space-between;align-items:center;padding:12px 20px;">
    <h1>Jayglo CellMoni Agent</h1>
    <div id="user-info" style="font-size:16px;font-weight:500;color:white;"></div>
  </div>

  <!-- Promo -->
  <marquee class="promo-banner" behavior="scroll" direction="left">
    Baim 5GB data long K5 tasol wantaim CellMoni | Pay water bill, PNG Air ticket, 100% bonus topup | Dial *888#
  </marquee>

  <!-- Nav -->
  <nav>
    <a href="dashboard.html" class="active">Dashboard</a>
    <a href="deposit.html">Deposit</a>
    <a href="withdraw.html">Withdraw</a>
    <a href="history.html">History</a>
    <a href="#" id="logoutBtn">Logout</a>
  </nav>

  <!-- Main -->
  <div class="form-container">
    <h2>Welcome to Your Dashboard</h2>

    <!-- NEW: Action buttons (non-destructive; just added) -->
    <div class="dash-actions" aria-label="Quick actions">
      <button class="circle-btn" data-target="history.html">History</button>
      <button class="circle-btn" data-target="deposit.html">Deposit</button>
      <button class="circle-btn" data-target="withdraw.html">Withdraw</button>
      <button class="circle-btn" data-target="https://wa.me/71634839" data-external="1">Customer<br/>Service</button>
    </div>

    <div class="section-spacer"></div>

    <!-- Live stats -->
    <div class="live-stats">
      Active Users: <span id="activeUsers">0</span>
    </div>

    <!-- Testimonials -->
    <div class="testimonials">
      <marquee behavior="scroll" direction="left" scrollamount="4" id="testimonials">
        Welcome to Jayglo! Fast deposits & withdrawals across PNG! | Trusted by hundreds of users every day!
      </marquee>
    </div>
  </div>

  <!-- Footer -->
  <div class="footer">
    <a href="https://wa.me/71634839" target="_blank">
      <button class="whatsapp-btn">Contact Customer Service</button>
    </a>
  </div>

  <script src="js/app.js"></script>
  <script>
    // Keep the same behavior you already had on dashboard:
    (function() {
      // Require auth to view dashboard
      const user = localStorage.getItem("loggedInUser");
      if (!user) {
        window.location.href = "login.html";
        return;
      }

      // Show user info (name + phone + profile pic if available)
      fetch("/getUser?phone=" + encodeURIComponent(user))
        .then(r => r.json())
        .then(d => {
          const el = document.getElementById("user-info");
          if (!el) return;
          if (d.success) {
            const img = d.profilePhoto ? `<img src="uploads/${d.profilePhoto}" alt="Profile" style="width:40px;height:40px;border-radius:50%;margin-right:8px;vertical-align:middle;object-fit:cover;">` : "";
            el.innerHTML = `${img}${d.fullName} | ${d.phone}`;
          } else {
            el.textContent = user;
          }
        }).catch(() => {});

      // Active users (same as before)
      let usersCount = 120;
      const activeEl = document.getElementById("activeUsers");
      if (activeEl) {
        activeEl.textContent = usersCount;
        setInterval(() => {
          usersCount += Math.floor(Math.random() * 3) - 1;
          activeEl.textContent = usersCount;
        }, 2000);
      }

      // Testimonials (same as before)
      fetch("/testimonials").then(r => r.json()).then(list => {
        const marq = document.getElementById("testimonials");
        if (Array.isArray(list) && list.length && marq) {
          marq.textContent = list.map(t => `${t.name}: ${t.message}`).join(" | ");
        }
      }).catch(() => {});

      // NEW: Button loading + redirect (scoped just to dashboard)
      const btns = document.querySelectorAll(".dash-actions .circle-btn");
      btns.forEach(btn => {
        btn.addEventListener("click", () => {
          // Loading state
          const label = btn.textContent;
          btn.textContent = "";
          btn.classList.add("loading");
          const spin = document.createElement("div");
          spin.className = "spinner";
          btn.appendChild(spin);

          const target = btn.getAttribute("data-target") || "dashboard.html";
          const external = btn.getAttribute("data-external") === "1";

          setTimeout(() => {
            if (external) {
              window.open(target, "_blank");
              // restore button quickly for user if they stay on page
              btn.removeChild(spin);
              btn.classList.remove("loading");
              btn.textContent = label;
            } else {
              window.location.href = target;
            }
          }, 600);
        });
      });
    })();
  </script>
</body>
</html>
