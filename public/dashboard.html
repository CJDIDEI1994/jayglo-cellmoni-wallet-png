<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Dashboard - Jayglo CellMoni Agent</title>
<link rel="stylesheet" href="css/style.css">
<style>
/* Top-right user info in header */
.user-info {
    position: absolute;
    top: 12px;
    right: 20px;
    color: white;
    font-weight: 500;
    font-size: 16px;
    text-align: right;
}
</style>
</head>
<body>
<div class="header" style="position: relative;">
    <h1>Jayglo CellMoni Agent</h1>
    <div class="user-info" id="user-info"></div>
</div>

<marquee class="promo-banner" behavior="scroll" direction="left">
    Baim 5GB data long K5 tasol wantaim CellMoni | Pay water bill, PNG Air ticket, 100% bonus topup | Dial *888#
</marquee>

<nav>
    <a href="dashboard.html">Dashboard</a>
    <a href="deposit.html">Deposit</a>
    <a href="withdraw.html">Withdraw</a>
    <a href="history.html">History</a>
    <a href="#" id="logoutBtn">Logout</a>
</nav>

<div class="form-container">
    <h2>Welcome to Your Dashboard</h2>
    <div class="live-stats">
        Active Users: <span id="activeUsers">0</span>
    </div>
    <div class="testimonials">
        <marquee behavior="scroll" direction="left" scrollamount="4" id="testimonials">
            Welcome to Jayglo! Fast deposits & withdrawals across PNG! | Trusted by hundreds of users every day!
        </marquee>
    </div>
</div>

<div class="footer">
    <a href="https://wa.me/71634839" target="_blank">
        <button class="whatsapp-btn">Contact Customer Service</button>
    </a>
</div>

<script src="js/app.js"></script>
<script>
const userPhone = localStorage.getItem("loggedInUser");
if(!userPhone) window.location.href = "login.html";

// Show user info top-right
async function loadUserInfo(phone){
    try{
        const res = await fetch(`/getUserInfo?phone=${phone}`);
        const data = await res.json();
        if(data.success){
            document.getElementById("user-info").innerText = `${data.fullName} | ${data.phone}`;
        } else {
            document.getElementById("user-info").innerText = "User Info Not Found";
        }
    }catch(err){
        document.getElementById("user-info").innerText = "Error Loading Info";
    }
}
loadUserInfo(userPhone);

let usersCount = 120;
setInterval(() => {
    usersCount += Math.floor(Math.random() * 3) - 1;
    document.getElementById("activeUsers").textContent = usersCount;
}, 2000);

fetch("/testimonials")
    .then(res => res.json())
    .then(data => {
        const marquee = document.getElementById("testimonials");
        marquee.textContent = data.map(t => `${t.name}: ${t.message}`).join(" | ");
    });

document.getElementById("logoutBtn").addEventListener("click", e=>{
    e.preventDefault();
    localStorage.removeItem("loggedInUser");
    window.location.href = "login.html";
});
</script>
</body>
</html>
